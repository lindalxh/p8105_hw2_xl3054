p8105_hw2_xl3054
================
Xinhui Lin (xl3054)
2025-10-01

# Problem 1

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
## pols_month
pols_month = read_csv(file = "./Data/pols-month.csv") %>%  ## load data
  janitor::clean_names() %>%  ## clean data
  separate(mon, into = c("year", "month", "day"), sep = "-") %>%  ## break up variable
  mutate(across(c(year, month, day), as.integer)) %>%  ## convert to integers
  mutate(month = month.name[month]) %>%  ## replace with month name
  mutate(president = case_when(prez_dem == 1 ~ "dem", 
                               prez_dem == 0 ~ "gop")) %>%  ## prez_dem and prez_gop into president
  select(-prez_gop, -prez_dem, -day)  ## remove variables
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
## snp
snp = read_csv(file = "./Data/snp.csv") %>%  ## load data
  janitor::clean_names() %>%  ## clean data
  separate(date, into = c("month", "day", "year"), sep = "/") %>%  ## break up variable
  mutate(across(c(year, month, day), as.integer)) %>%  ## convert to integers
  mutate(month = month.name[month]) %>%  ## replace with month name
  select(year, everything()) %>%  ## move year as leading
  select(-day) %>%  ## remove day
  mutate(year = if_else(year < 50, year + 2000, year + 1900))  ## make year consistent with previous
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
## unemployment
unemployment = read_csv(file = "./Data/unemployment.csv") %>%  ## load data
  janitor::clean_names() %>%  ## clean data
  rename_with(
    ~ month.name[match(., tolower(month.abb))],
    .cols = any_of(tolower(month.abb))) %>%  ## rename month to full names
  pivot_longer(cols = -year, 
               names_to = "month", 
               values_to = "unemp_rate")  ## switch from wide to long format
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
## merging datasets
join_12 = left_join(pols_month, snp, by = c("year", "month"))
join_123 = left_join(join_12, unemployment, by = c("year", "month")) %>% 
  select(year, month, president, everything())
```

The `pols_month` dataset contains 822 observations with variables
describing the number of democratic and republican governors and
senators from 1947 to 2015. The `president` variable indicates whether
the president was republican or democratic in each year. The `snp`
dataset contains 787 observations with the variable `close` on the
closing values of the Standard & Poor’s stock index from 1950 to 2015.
The `unemployment` dataset contains the `unemp_rate` variable, which
indicates the unemployment rate in each month from 1948 to 2015. The
combined dataset `join_123` contains 822 observations and 11 columns in
total, which includes variables for number of democratic and republican
politicians, closing values of the S&P stock index, and monthly
unemployment rate from 1947 to 2015.

# Problem 2

``` r
## mr trash wheel
library(readxl)
mr_trash = read_excel("./Data/202509 Trash Wheel Collection Data.xlsx", 
                      sheet = 1, skip = 1) %>% ## load data
  janitor::clean_names() %>%  ## clean data
  drop_na(dumpster) %>%  ## remove na rows "total"
  select(-c(15, 16)) %>%  ## remove notes columns
  mutate(sports_balls = as.integer(round(sports_balls)),  ## round & convert
         year = as.double(year),  ## convert year to integer for combining
         trash_type = "mr trash")  ## add trash type
```

    ## New names:
    ## • `` -> `...15`
    ## • `` -> `...16`

``` r
## prof trash wheel
prof_trash = read_excel("./Data/202509 Trash Wheel Collection Data.xlsx", 
                        sheet = 2, skip = 1) %>% ## load data
  janitor::clean_names() %>% ## clean data
  drop_na(dumpster) %>%  ## remove na rows "total"
  mutate(trash_type = "prof trash")  ## add trash type

## gwynnda trash wheel
gwynnda_trash = read_excel("./Data/202509 Trash Wheel Collection Data.xlsx", 
                           sheet = 4, skip = 1) %>%  ## load data
  janitor::clean_names() %>%  ## clean data
  drop_na(dumpster) %>%  ## remove na rows "total"
  mutate(trash_type = "gwynnda trash") ## add trash type

## combining datasets
combined_trash = bind_rows(mr_trash, prof_trash, gwynnda_trash)
```

There are 707, 132, and 349 observations in `mr_trash`, `prof_trash`,
and `gwynnda_trash` datasets, respectively. Each dataset includes
variables regarding the weight of trash, number of plastic/glass
bottles, cigarettes, and plastic bags, and other different kinds of
trash. In the combined dataset `combined_trash`, there are 1188
observations in total. The total weight of trash collected by Professor
Trash Wheel is 282.26 tons.

``` r
## filter for June 2022
gwynnda_2022_6 = gwynnda_trash %>% filter(year == 2022, month == "June")
```

In June of 2022, the total number of cigarette butts collected by
Gwynnda is 18120.

# Problem 3

``` r
## zip code
zip_codes = read_csv(file = "./Data/Zip Codes.csv") %>%  ## load data
  janitor::clean_names() %>%  ## clean data
  select(zip_code, county, neighborhood, county_fips) %>%  ## select related columns
  slice(-c(226, 227)) ## remove repeated zipcodes
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
## zori
zori = read_csv(file = "./Data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>%  ## load data
  janitor::clean_names() %>%  ## clean data
  pivot_longer(cols = starts_with("x"), 
    names_to = "date",
    values_to = "zori") %>%  ## pivot longer by dats
  mutate(date = str_remove(date, "^x")) %>%  ## clean date format
  separate(date, into = c("year", "month", "day"), sep = "_") %>%  ## separate into year, month, day
  mutate(year = as.integer(year), 
    month = month.name[as.integer(month)]) %>%
  select(-c(state))  ## make year into integer, month as full name, remove state (repeated)
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
## merging
combined = right_join(zip_codes, zori, by = c("zip_code" = "region_name")) %>%
  select(year, month, ## time
         zip_code, county_fips, region_id,  ## ids
         state_name, city, county_name, region_type, neighborhood, metro, size_rank,  ## geographic
         zori) ## metric
```

The resulting combined dataset contains 17284 observations in total,
with variables indicating and describing the region id, zipcode, area
name, neighborhood, and Zillow Observed Rent Index (ZORI) on the last
day of each month from 2015 to 2024. Within the 17284 observations,
there are 10450 available ZORI data. There are 149 unique zipcodes
included, and 43 unique neighborhoods.

``` r
## missing zip codes in zillow
zori_missing = zip_codes %>%
  anti_join(zori, by = c("zip_code" = "region_name"))
```

There are 171 zip codes that appear in the ZIP code dataset, but not in
the Zillow Rental Price dataset. These zip codes are likely excluded
because the corresponding areas are not primarily residential, and
Zillow focuses on residential rental listings. For example, ZIP code
10166 covers the MetLife Building and Grand Central Terminal, which are
locations that are commercial rather than residential. Zip code 10474
(Hunts Point) is an industrial and market hub, not a housing area, so
rental data is not available. Zip code 10309 includes mostly state parks
and shopping centers, which explains its absence from Zillow’s rental
data.

``` r
## top 10 price drop
top10_drop = combined %>% 
  filter(year %in% c(2020, 2021), month == "January") %>%  ## filter for Jan 2020 and Jan 2021
  select(zip_code, county_name, county_name, neighborhood, year, zori) %>%  ## select related columns
  rename(borough = county_name) %>%  ## change county_name to borough
  pivot_wider(names_from = year,
              values_from = zori,
              names_prefix = "zori_") %>%  ## pivot wider by date
  mutate(diff_20to21 = zori_2021 - zori_2020) %>%  ## calculate difference
  arrange(diff_20to21) %>%  ## order difference
  head(10) %>%  ## choose top 10
  mutate(borough = "Manhattan")  ## change New York County to Manhattan
top10_drop
```

    ## # A tibble: 10 × 6
    ##    zip_code borough   neighborhood               zori_2020 zori_2021 diff_20to21
    ##       <dbl> <chr>     <chr>                          <dbl>     <dbl>       <dbl>
    ##  1    10007 Manhattan Lower Manhattan                6334.     5422.       -913.
    ##  2    10069 Manhattan <NA>                           4623.     3875.       -748.
    ##  3    10009 Manhattan Lower East Side                3406.     2692.       -714.
    ##  4    10016 Manhattan Gramercy Park and Murray …     3731.     3019.       -712.
    ##  5    10001 Manhattan Chelsea and Clinton            4108.     3398.       -710.
    ##  6    10002 Manhattan Lower East Side                3645.     2935.       -710.
    ##  7    10004 Manhattan Lower Manhattan                3150.     2444.       -706.
    ##  8    10038 Manhattan Lower Manhattan                3573.     2876.       -698.
    ##  9    10012 Manhattan Greenwich Village and Soho     3629.     2942.       -686.
    ## 10    10010 Manhattan Gramercy Park and Murray …     3697.     3012.       -685.

The top 10 largest drop in price from January 2020 to 2021 all happened
in Manhattan. The largest drop in price is from 6334.2106678 to
5421.614077 with a drop of -912.5965909 in Lower Manhattan.
